import {
  __privateAdd,
  __privateGet,
  __privateSet,
  __publicField
} from "./chunk-45IN2YCG.js";

// node_modules/fatfs-wasm/fatfs.min.mjs
var t;
var e;
var r;
var n;
var i;
!function(t2) {
  t2[t2.CTRL_SYNC = 0] = "CTRL_SYNC", t2[t2.GET_SECTOR_COUNT = 1] = "GET_SECTOR_COUNT", t2[t2.GET_SECTOR_SIZE = 2] = "GET_SECTOR_SIZE", t2[t2.GET_BLOCK_SIZE = 3] = "GET_BLOCK_SIZE", t2[t2.CTRL_TRIM = 4] = "CTRL_TRIM";
}(t || (t = {})), function(t2) {
  t2[t2.FAT = 1] = "FAT", t2[t2.FAT32 = 2] = "FAT32", t2[t2.EXFAT = 4] = "EXFAT", t2[t2.ANY = 7] = "ANY", t2[t2.SFD = 8] = "SFD";
}(e || (e = {})), function(t2) {
  t2[t2.OK = 0] = "OK", t2[t2.DISK_ERR = 1] = "DISK_ERR", t2[t2.INT_ERR = 2] = "INT_ERR", t2[t2.NOT_READY = 3] = "NOT_READY", t2[t2.NO_FILE = 4] = "NO_FILE", t2[t2.NO_PATH = 5] = "NO_PATH", t2[t2.INVALID_NAME = 6] = "INVALID_NAME", t2[t2.DENIED = 7] = "DENIED", t2[t2.EXIST = 8] = "EXIST", t2[t2.INVALID_OBJECT = 9] = "INVALID_OBJECT", t2[t2.WRITE_PROTECTED = 10] = "WRITE_PROTECTED", t2[t2.INVALID_DRIVE = 11] = "INVALID_DRIVE", t2[t2.NOT_ENABLED = 12] = "NOT_ENABLED", t2[t2.NO_FILESYSTEM = 13] = "NO_FILESYSTEM", t2[t2.MKFS_ABORTED = 14] = "MKFS_ABORTED", t2[t2.TIMEOUT = 15] = "TIMEOUT", t2[t2.LOCKED = 16] = "LOCKED", t2[t2.NOT_ENOUGH_CORE = 17] = "NOT_ENOUGH_CORE", t2[t2.TOO_MANY_OPEN_FILES = 18] = "TOO_MANY_OPEN_FILES", t2[t2.INVALID_PARAMETER = 19] = "INVALID_PARAMETER";
}(r || (r = {})), function(t2) {
  t2[t2.RDO = 1] = "RDO", t2[t2.HID = 2] = "HID", t2[t2.SYS = 4] = "SYS", t2[t2.DIR = 16] = "DIR", t2[t2.ARC = 32] = "ARC";
}(n || (n = {})), function(t2) {
  t2[t2.READ = 1] = "READ", t2[t2.WRITE = 2] = "WRITE", t2[t2.OPEN_EXISTING = 0] = "OPEN_EXISTING", t2[t2.CREATE_NEW = 4] = "CREATE_NEW", t2[t2.CREATE_ALWAYS = 8] = "CREATE_ALWAYS", t2[t2.OPEN_ALWAYS = 16] = "OPEN_ALWAYS", t2[t2.OPEN_APPEND = 48] = "OPEN_APPEND";
}(i || (i = {}));
var s = 24;
var o = new URL(new URL("assets/ff_multi-DauRTzqn.wasm", import.meta.url).href, import.meta.url);
var c = new URL(new URL("assets/ff_single-BRr2adYw.wasm", import.meta.url).href, import.meta.url);
function a(t2, e2, n2) {
  const i2 = e2();
  if (i2 !== r.OK) throw n2 == null ? void 0 : n2(), new u(t2, i2);
}
var _t, _e;
var l = class {
  constructor(t2, e2) {
    __privateAdd(this, _t);
    __privateAdd(this, _e);
    __privateSet(this, _t, t2), __privateSet(this, _e, e2);
  }
  get ptr() {
    return __privateGet(this, _t);
  }
  get cSize() {
    return __privateGet(this, _e).view.getUint16(__privateGet(this, _t) + 10, true);
  }
};
_t = new WeakMap();
_e = new WeakMap();
var _r, _n;
var h = class {
  constructor(t2, e2) {
    __privateAdd(this, _r);
    __privateAdd(this, _n);
    __privateSet(this, _r, t2), __privateSet(this, _n, e2);
  }
  get heap() {
    return new Uint8Array(__privateGet(this, _r).buffer);
  }
  get view() {
    return new DataView(__privateGet(this, _r).buffer);
  }
  allocString(t2) {
    if (null == t2) return 0;
    const e2 = new TextEncoder().encode(t2), r2 = this.alloc(e2.length + 1), n2 = this.heap.subarray(r2, r2 + e2.length + 1);
    return n2.set(e2), n2[n2.length - 1] = 0, r2;
  }
  alloc(t2) {
    return __privateGet(this, _n).malloc(t2);
  }
  free(t2) {
    __privateGet(this, _n).free(t2);
  }
  decodeString(t2, e2) {
    const r2 = this.heap.subarray(t2, t2 + e2), n2 = r2.indexOf(0), i2 = n2 >= 0 ? r2.subarray(0, n2) : r2;
    return new TextDecoder().decode(i2);
  }
  enterScope(t2) {
    const e2 = [], r2 = { alloc: (t3) => {
      const r3 = this.alloc(t3);
      return e2.unshift(r3), r3;
    }, allocString: (t3) => {
      const r3 = this.allocString(t3);
      return e2.unshift(r3), r3;
    } };
    try {
      return t2(r2);
    } finally {
      for (const t3 of e2) this.free(t3);
    }
  }
};
_r = new WeakMap();
_n = new WeakMap();
var f = class _f {
  constructor(t2, e2, r2, n2) {
    __publicField(this, "size");
    __publicField(this, "date");
    __publicField(this, "attrib");
    __publicField(this, "name");
    this.size = t2, this.date = e2, this.attrib = r2, this.name = n2;
  }
  static fromFilInfo(t2) {
    const e2 = new DataView(t2.buffer, t2.byteOffset, t2.byteLength), r2 = e2.getUint32(0, true), n2 = e2.getUint16(4, true), i2 = 1980 + ((65024 & n2) >> 9), s2 = ((480 & n2) >> 5) - 1, o2 = 31 & n2, c2 = e2.getUint16(6, true), a2 = new Date(i2, s2, o2, (63488 & c2) >> 11, (2016 & c2) >> 5, 2 * (31 & c2)), l2 = t2[8], h2 = t2.subarray(9, 22), u2 = h2.indexOf(0), x2 = u2 >= 0 ? h2.subarray(0, u2) : h2, p2 = new TextDecoder().decode(x2);
    return new _f(r2, a2, l2, p2);
  }
  get isReadOnly() {
    return !!(this.attrib & n.RDO);
  }
  get isDirectory() {
    return !!(this.attrib & n.DIR);
  }
  get isHidden() {
    return !!(this.attrib & n.HID);
  }
  get isArchive() {
    return !!(this.attrib & n.ARC);
  }
  get isSystem() {
    return !!(this.attrib & n.SYS);
  }
};
var u = class _u extends Error {
  constructor(t2, e2) {
    super(`Error ${t2}: ${r[e2]} (${e2})`);
    __publicField(this, "result");
    Object.setPrototypeOf(this, _u.prototype), this.result = e2;
  }
};
var _i, _n2, _e2;
var x = class {
  constructor(t2, e2, r2) {
    __privateAdd(this, _i);
    __privateAdd(this, _n2);
    __privateAdd(this, _e2);
    __privateSet(this, _i, t2), __privateSet(this, _n2, e2), __privateSet(this, _e2, r2);
  }
  get fp() {
    return __privateGet(this, _i);
  }
  read(t2, e2) {
    const r2 = __privateGet(this, _n2).f_read, n2 = __privateGet(this, _i), i2 = e2 ?? t2.length;
    return __privateGet(this, _e2).enterScope((e3) => {
      const s2 = e3.alloc(i2), o2 = e3.alloc(4);
      a("reading file", () => r2(n2, s2, i2, o2));
      const c2 = __privateGet(this, _e2).view.getUint32(o2, true);
      return t2.set(__privateGet(this, _e2).heap.subarray(s2, s2 + c2)), c2;
    });
  }
  write(t2, e2) {
    return __privateGet(this, _e2).enterScope((r2) => {
      const n2 = e2 ?? t2.length, i2 = r2.alloc(n2), s2 = r2.alloc(4);
      return __privateGet(this, _e2).heap.subarray(i2, i2 + n2).set(t2), a("writing file", () => __privateGet(this, _n2).f_write(__privateGet(this, _i), i2, n2, s2)), __privateGet(this, _e2).view.getUint32(s2, true);
    });
  }
  close() {
    try {
      a("closing file", () => __privateGet(this, _n2).f_close(__privateGet(this, _i)));
    } finally {
      __privateGet(this, _n2).free(__privateGet(this, _i));
    }
  }
  sync() {
    a("syncing disk", () => __privateGet(this, _n2).f_sync(__privateGet(this, _i)));
  }
  lseek(t2) {
    a("seeking", () => __privateGet(this, _n2).f_lseek(__privateGet(this, _i), t2));
  }
  rewind() {
    this.lseek(0);
  }
  truncate() {
    a("truncating file", () => __privateGet(this, _n2).f_truncate(__privateGet(this, _i)));
  }
  expand(t2, e2) {
    a("expanding file", () => __privateGet(this, _n2).f_expand(__privateGet(this, _i), t2, e2));
  }
  gets(t2) {
    return __privateGet(this, _e2).enterScope((e2) => {
      const r2 = e2.alloc(t2 + 1);
      return a("reading string from file", () => __privateGet(this, _n2).f_gets(r2, t2, __privateGet(this, _i))), __privateGet(this, _e2).decodeString(r2, t2 + 1);
    });
  }
  putc(t2) {
    const e2 = t2 % 256;
    return __privateGet(this, _n2).f_putc(e2, __privateGet(this, _i));
  }
  puts(t2) {
    const e2 = __privateGet(this, _n2).f_puts;
    return __privateGet(this, _e2).enterScope((r2) => {
      const n2 = r2.allocString(t2);
      return e2(n2, __privateGet(this, _i));
    });
  }
  tell() {
    return __privateGet(this, _n2).f_tell(__privateGet(this, _i));
  }
  eof(t2) {
    return __privateGet(this, _n2).f_eof(__privateGet(this, _i));
  }
  size() {
    return __privateGet(this, _n2).f_size(__privateGet(this, _i));
  }
  error(t2) {
    return __privateGet(this, _n2).f_error(__privateGet(this, _i));
  }
};
_i = new WeakMap();
_n2 = new WeakMap();
_e2 = new WeakMap();
var _s, _n3, _e3;
var p = class {
  constructor(t2, e2, r2) {
    __privateAdd(this, _s);
    __privateAdd(this, _n3);
    __privateAdd(this, _e3);
    __privateSet(this, _s, t2), __privateSet(this, _n3, e2), __privateSet(this, _e3, r2);
  }
  get dp() {
    return __privateGet(this, _s);
  }
  close() {
    a("closing directory", () => __privateGet(this, _n3).f_closedir(__privateGet(this, _s))), __privateGet(this, _e3).free(__privateGet(this, _s));
  }
  read() {
    return __privateGet(this, _e3).enterScope((t2) => {
      const e2 = t2.alloc(s);
      a("reading directory", () => __privateGet(this, _n3).f_readdir(__privateGet(this, _s), e2));
      const r2 = __privateGet(this, _e3).heap.subarray(e2, e2 + s);
      return f.fromFilInfo(r2);
    });
  }
  rewind() {
    a("rewinding directory", () => __privateGet(this, _n3).f_readdir(__privateGet(this, _s), 0));
  }
  findNext() {
    return __privateGet(this, _e3).enterScope((t2) => {
      const e2 = t2.alloc(s);
      a("searching directory for next match", () => __privateGet(this, _n3).f_findnext(__privateGet(this, _s), e2));
      const r2 = __privateGet(this, _e3).heap.subarray(e2, e2 + s);
      return f.fromFilInfo(r2);
    });
  }
  *[Symbol.iterator]() {
    let t2;
    for (this.rewind(); "" !== (t2 = this.read()).name; ) yield t2;
  }
};
_s = new WeakMap();
_n3 = new WeakMap();
_e3 = new WeakMap();
var g = { multiPartition: false, sectorSize: 512 };
var _e4, _n4;
var __ = class __ {
  constructor(t2, e2) {
    __privateAdd(this, _e4);
    __privateAdd(this, _n4);
    __privateSet(this, _e4, t2), __privateSet(this, _n4, e2);
  }
  static async create(e2, n2) {
    const i2 = new WebAssembly.Memory({ initial: 8 }), s2 = { ...g, ...n2 ?? {} }, a2 = function(e3, n3, i3) {
      const s3 = 0 | (i3 ?? 512), o2 = n3.byteLength / s3 | 0;
      return { env: { memory: e3, disk_initialize: (t2) => r.OK, disk_status: (t2) => r.OK, disk_read: (t2, i4, o3, c2) => {
        const a3 = n3.subarray(o3 * s3, (o3 + c2) * s3);
        return new Uint8Array(e3.buffer).set(a3, i4), r.OK;
      }, disk_write: (t2, i4, o3, c2) => {
        const a3 = new Uint8Array(e3.buffer).subarray(i4, i4 + c2 * s3);
        return n3.set(a3, o3 * s3), r.OK;
      }, disk_ioctl: (n4, i4, c2) => {
        const a3 = new DataView(e3.buffer);
        switch (i4) {
          case t.CTRL_SYNC:
            break;
          case t.GET_SECTOR_SIZE:
            a3.setUint16(c2, s3, true);
            break;
          case t.GET_SECTOR_COUNT:
            a3.setUint32(c2, o2, true);
            break;
          case t.GET_BLOCK_SIZE:
            return 1;
          case t.CTRL_TRIM:
        }
        return r.OK;
      }, get_fattime: () => {
        const t2 = /* @__PURE__ */ new Date();
        return (t2.getFullYear() - 1980) % 128 << 25 | t2.getMonth() + 1 << 21 | t2.getDay() << 16 | t2.getHours() << 11 | t2.getMinutes() << 5 | t2.getSeconds() >> 1;
      } } };
    }(i2, e2, s2.sectorSize), l2 = await async function(t2, e3) {
      const r2 = (e3 == null ? void 0 : e3.multiPartition) ? o : c;
      if ("undefined" != typeof window) return await WebAssembly.instantiateStreaming(fetch(r2), t2);
      {
        const { readFile: e4 } = await import("./promises-QMEEUOFK.js"), { fileURLToPath: n3 } = await import("./node_url-ANX3LEOJ.js"), i3 = await e4(n3(r2));
        return await WebAssembly.instantiate(i3, t2);
      }
    }(a2, s2), f2 = l2.instance.exports, u2 = new h(i2, f2);
    return s2.multiPartition ? new d(u2, f2) : new __(u2, f2);
  }
  mkfs(t2) {
    __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString((t2 == null ? void 0 : t2.path) ?? "");
      let n2 = 0;
      if (null != t2) {
        n2 = e2.alloc(16);
        const r3 = __privateGet(this, _e4).view;
        r3.setUint8(n2, (t2 == null ? void 0 : t2.fmt) ?? 0), r3.setUint8(n2 + 1, (t2 == null ? void 0 : t2.nFat) ?? 0), r3.setUint32(n2 + 2, (t2 == null ? void 0 : t2.align) ?? 0, true), r3.setUint32(n2 + 6, (t2 == null ? void 0 : t2.nRoot) ?? 0, true), r3.setUint32(n2 + 10, (t2 == null ? void 0 : t2.auSize) ?? 0, true);
      }
      const i2 = e2.alloc(4096);
      a("formatting disk", () => __privateGet(this, _n4).f_mkfs(r2, n2, i2, 4096));
    });
  }
  mount(t2, e2) {
    const r2 = (t3) => __privateGet(this, _e4).alloc(t3);
    return __privateGet(this, _e4).enterScope((n2) => {
      const i2 = r2(560);
      for (let t3 = 0; t3 < 560; t3++) __privateGet(this, _e4).heap[i2 + t3] = 0;
      const s2 = n2.allocString(t2 ?? "");
      return a("mounting workspace", () => __privateGet(this, _n4).f_mount(i2, s2, e2 ?? 0), () => __privateGet(this, _e4).free(i2)), new l(i2, __privateGet(this, _e4));
    });
  }
  unmount(t2) {
    return __privateGet(this, _e4).enterScope((e2) => {
      try {
        const r2 = e2.allocString(t2 ?? "");
        a("unmounting workspace", () => __privateGet(this, _n4).f_mount(0, r2, 0));
      } finally {
      }
    });
  }
  open(t2, e2) {
    return __privateGet(this, _e4).enterScope((r2) => {
      const n2 = r2.allocString(t2), i2 = __privateGet(this, _e4).alloc(576);
      return a("opening file", () => __privateGet(this, _n4).f_open(i2, n2, e2), () => __privateGet(this, _e4).free(i2)), new x(i2, __privateGet(this, _n4), __privateGet(this, _e4));
    });
  }
  session(t2, e2 = "") {
    this.mount(e2);
    try {
      return t2();
    } finally {
      this.unmount(e2);
    }
  }
  readFile(t2) {
    const e2 = this.stat(t2), r2 = new Uint8Array(e2.size), n2 = this.open(t2, i.READ);
    try {
      return n2.read(r2), r2;
    } finally {
      n2.close();
    }
  }
  writeFile(t2, e2) {
    const r2 = this.open(t2, i.WRITE | i.OPEN_ALWAYS);
    try {
      r2.write(e2);
    } finally {
      r2.close();
    }
  }
  openDir(t2) {
    return __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2), n2 = __privateGet(this, _e4).alloc(64);
      return a("opening directory", () => __privateGet(this, _n4).f_opendir(n2, r2), () => __privateGet(this, _e4).free(n2)), new p(n2, __privateGet(this, _n4), __privateGet(this, _e4));
    });
  }
  findFirst(t2, e2) {
    return __privateGet(this, _e4).enterScope((r2) => {
      const n2 = r2.allocString(t2), i2 = r2.allocString(e2), o2 = r2.alloc(s), c2 = __privateGet(this, _e4).alloc(64);
      a("searching directory", () => __privateGet(this, _n4).f_findfirst(c2, o2, n2, i2));
      const l2 = __privateGet(this, _e4).heap.subarray(o2, o2 + s);
      return [new p(c2, __privateGet(this, _n4), __privateGet(this, _e4)), f.fromFilInfo(l2)];
    });
  }
  *find(t2, e2) {
    let r2, n2;
    for ([r2, n2] = this.findFirst(t2, e2); "" !== n2.name; ) yield n2, n2 = r2.findNext();
  }
  stat(t2) {
    return __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2), n2 = e2.alloc(s);
      a("getting file information", () => __privateGet(this, _n4).f_stat(r2, n2));
      const i2 = __privateGet(this, _e4).heap.subarray(n2, n2 + s);
      return f.fromFilInfo(i2);
    });
  }
  unlink(t2) {
    __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2);
      a("deleting file or directory", () => __privateGet(this, _n4).f_unlink(r2));
    });
  }
  rename(t2, e2) {
    __privateGet(this, _e4).enterScope((r2) => {
      const n2 = r2.allocString(t2), i2 = r2.allocString(e2);
      a("renaming file or directory", () => __privateGet(this, _n4).f_rename(n2, i2));
    });
  }
  chmod(t2, e2, r2) {
    __privateGet(this, _e4).enterScope((n2) => {
      const i2 = n2.allocString(t2);
      a("changing file or directory permissions", () => __privateGet(this, _n4).f_chmod(i2, e2, r2));
    });
  }
  utime(t2, e2) {
    __privateGet(this, _e4).enterScope((r2) => {
      const n2 = r2.allocString(t2), i2 = r2.alloc(24), s2 = (e2.getFullYear() - 1980 & 127) << 9 | e2.getMonth() + 1 << 5 | e2.getDay();
      __privateGet(this, _e4).view.setUint16(i2 + 4, s2, true);
      const o2 = e2.getHours() << 11 | e2.getMinutes() << 5 | e2.getSeconds() >>> 1;
      __privateGet(this, _e4).view.setUint16(i2 + 6, o2, true), a("changing timestamp of file or directory", () => __privateGet(this, _n4).f_utime(n2, i2));
    });
  }
  mkdir(t2) {
    __privateGet(this, _n4).f_mkdir, __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2);
      a("creating directory", () => __privateGet(this, _n4).f_mkdir(r2));
    });
  }
  chdir(t2) {
    __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2);
      a("changing current directory", () => __privateGet(this, _n4).f_chdir(r2));
    });
  }
  chdrive(t2) {
    __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2);
      a("changing current drive", () => __privateGet(this, _n4).f_chdrive(r2));
    });
  }
  getcwd() {
    return __privateGet(this, _e4).enterScope((t2) => {
      const e2 = t2.alloc(260);
      return a("getting current directory", () => __privateGet(this, _n4).f_getcwd(e2, 260)), __privateGet(this, _e4).decodeString(e2, 260);
    });
  }
  getFree(t2) {
    return __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2 ?? ""), n2 = e2.alloc(4), i2 = e2.alloc(4);
      return a("getting free space on drive", () => __privateGet(this, _n4).f_getfree(r2, n2, i2)), [__privateGet(this, _e4).view.getUint32(n2, true), new l(i2, __privateGet(this, _e4))];
    });
  }
  getLabel(t2) {
    return __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2 ?? ""), n2 = e2.alloc(13);
      __privateGet(this, _e4).heap[n2 + 12] = 0;
      const i2 = e2.alloc(4);
      return a("getting volume label", () => __privateGet(this, _n4).f_getlabel(r2, n2, i2)), [__privateGet(this, _e4).decodeString(n2, 13), __privateGet(this, _e4).view.getUint32(i2, true)];
    });
  }
  setLabel(t2) {
    __privateGet(this, _e4).enterScope((e2) => {
      const r2 = e2.allocString(t2);
      a("setting volume label", () => __privateGet(this, _n4).f_setlabel(r2));
    });
  }
  setCP(t2) {
    const e2 = __privateGet(this, _n4).f_setcp;
    a("setting active code page", () => e2(t2));
  }
};
_e4 = new WeakMap();
_n4 = new WeakMap();
var _ = __;
var _e5, _n5;
var d = class extends _ {
  constructor(t2, e2) {
    super(t2, e2);
    __privateAdd(this, _e5);
    __privateAdd(this, _n5);
    __privateSet(this, _e5, t2), __privateSet(this, _n5, e2);
  }
  fdisk(t2, e2) {
    __privateGet(this, _e5).enterScope((r2) => {
      const n2 = r2.alloc(512), i2 = r2.alloc(4 * t2.length);
      for (let e3 = 0; e3 < t2.length; e3++) __privateGet(this, _e5).view.setUint32(i2 + 4 * e3, t2[e3]);
      a("partitioning disk", () => __privateGet(this, _n5).f_fdisk(e2 ?? 0, i2, n2));
    });
  }
};
_e5 = new WeakMap();
_n5 = new WeakMap();
export {
  n as FatFsAttrib,
  p as FatFsDir,
  _ as FatFsDisk,
  d as FatFsDiskPartitionable,
  u as FatFsError,
  x as FatFsFile,
  f as FatFsFileInfo,
  e as FatFsFormat,
  t as FatFsIoctl,
  i as FatFsMode,
  r as FatFsResult
};
//# sourceMappingURL=fatfs-wasm.js.map
