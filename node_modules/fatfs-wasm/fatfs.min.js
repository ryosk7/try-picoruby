!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["fatfs-wasm"]={})}(this,(function(t){"use strict";var e,r,n,s,i,o="undefined"!=typeof document?document.currentScript:null;t.FatFsIoctl=void 0,(e=t.FatFsIoctl||(t.FatFsIoctl={}))[e.CTRL_SYNC=0]="CTRL_SYNC",e[e.GET_SECTOR_COUNT=1]="GET_SECTOR_COUNT",e[e.GET_SECTOR_SIZE=2]="GET_SECTOR_SIZE",e[e.GET_BLOCK_SIZE=3]="GET_BLOCK_SIZE",e[e.CTRL_TRIM=4]="CTRL_TRIM",t.FatFsFormat=void 0,(r=t.FatFsFormat||(t.FatFsFormat={}))[r.FAT=1]="FAT",r[r.FAT32=2]="FAT32",r[r.EXFAT=4]="EXFAT",r[r.ANY=7]="ANY",r[r.SFD=8]="SFD",t.FatFsResult=void 0,(n=t.FatFsResult||(t.FatFsResult={}))[n.OK=0]="OK",n[n.DISK_ERR=1]="DISK_ERR",n[n.INT_ERR=2]="INT_ERR",n[n.NOT_READY=3]="NOT_READY",n[n.NO_FILE=4]="NO_FILE",n[n.NO_PATH=5]="NO_PATH",n[n.INVALID_NAME=6]="INVALID_NAME",n[n.DENIED=7]="DENIED",n[n.EXIST=8]="EXIST",n[n.INVALID_OBJECT=9]="INVALID_OBJECT",n[n.WRITE_PROTECTED=10]="WRITE_PROTECTED",n[n.INVALID_DRIVE=11]="INVALID_DRIVE",n[n.NOT_ENABLED=12]="NOT_ENABLED",n[n.NO_FILESYSTEM=13]="NO_FILESYSTEM",n[n.MKFS_ABORTED=14]="MKFS_ABORTED",n[n.TIMEOUT=15]="TIMEOUT",n[n.LOCKED=16]="LOCKED",n[n.NOT_ENOUGH_CORE=17]="NOT_ENOUGH_CORE",n[n.TOO_MANY_OPEN_FILES=18]="TOO_MANY_OPEN_FILES",n[n.INVALID_PARAMETER=19]="INVALID_PARAMETER",t.FatFsAttrib=void 0,(s=t.FatFsAttrib||(t.FatFsAttrib={}))[s.RDO=1]="RDO",s[s.HID=2]="HID",s[s.SYS=4]="SYS",s[s.DIR=16]="DIR",s[s.ARC=32]="ARC",t.FatFsMode=void 0,(i=t.FatFsMode||(t.FatFsMode={}))[i.READ=1]="READ",i[i.WRITE=2]="WRITE",i[i.OPEN_EXISTING=0]="OPEN_EXISTING",i[i.CREATE_NEW=4]="CREATE_NEW",i[i.CREATE_ALWAYS=8]="CREATE_ALWAYS",i[i.OPEN_ALWAYS=16]="OPEN_ALWAYS",i[i.OPEN_APPEND=48]="OPEN_APPEND";const c=24,a=new URL("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__dirname+"/assets/ff_multi-DauRTzqn.wasm").href:new URL("assets/ff_multi-DauRTzqn.wasm","undefined"==typeof document?location.href:document.currentScript&&"SCRIPT"===document.currentScript.tagName.toUpperCase()&&document.currentScript.src||document.baseURI).href,"undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:o&&"SCRIPT"===o.tagName.toUpperCase()&&o.src||new URL("fatfs.min.js",document.baseURI).href),l=new URL("undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__dirname+"/assets/ff_single-BRr2adYw.wasm").href:new URL("assets/ff_single-BRr2adYw.wasm","undefined"==typeof document?location.href:document.currentScript&&"SCRIPT"===document.currentScript.tagName.toUpperCase()&&document.currentScript.src||document.baseURI).href,"undefined"==typeof document&&"undefined"==typeof location?require("url").pathToFileURL(__filename).href:"undefined"==typeof document?location.href:o&&"SCRIPT"===o.tagName.toUpperCase()&&o.src||new URL("fatfs.min.js",document.baseURI).href);function h(e,r,n){const s=r();if(s!==t.FatFsResult.OK)throw n?.(),new x(e,s)}function f(e,r,n){const s=0|(n??512),i=r.byteLength/s|0;return{env:{memory:e,disk_initialize:e=>t.FatFsResult.OK,disk_status:e=>t.FatFsResult.OK,disk_read:(n,i,o,c)=>{const a=r.subarray(o*s,(o+c)*s);return new Uint8Array(e.buffer).set(a,i),t.FatFsResult.OK},disk_write:(n,i,o,c)=>{const a=new Uint8Array(e.buffer).subarray(i,i+c*s);return r.set(a,o*s),t.FatFsResult.OK},disk_ioctl:(r,n,o)=>{const c=new DataView(e.buffer);switch(n){case t.FatFsIoctl.CTRL_SYNC:break;case t.FatFsIoctl.GET_SECTOR_SIZE:c.setUint16(o,s,!0);break;case t.FatFsIoctl.GET_SECTOR_COUNT:c.setUint32(o,i,!0);break;case t.FatFsIoctl.GET_BLOCK_SIZE:return 1;case t.FatFsIoctl.CTRL_TRIM:}return t.FatFsResult.OK},get_fattime:()=>{const t=new Date;return(t.getFullYear()-1980)%128<<25|t.getMonth()+1<<21|t.getDay()<<16|t.getHours()<<11|t.getMinutes()<<5|t.getSeconds()>>1}}}}class u{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get ptr(){return this.#t}get cSize(){return this.#e.view.getUint16(this.#t+10,!0)}}class d{#r;#n;constructor(t,e){this.#r=t,this.#n=e}get heap(){return new Uint8Array(this.#r.buffer)}get view(){return new DataView(this.#r.buffer)}allocString(t){if(null==t)return 0;const e=(new TextEncoder).encode(t),r=this.alloc(e.length+1),n=this.heap.subarray(r,r+e.length+1);return n.set(e),n[n.length-1]=0,r}alloc(t){return this.#n.malloc(t)}free(t){this.#n.free(t)}decodeString(t,e){const r=this.heap.subarray(t,t+e),n=r.indexOf(0),s=n>=0?r.subarray(0,n):r;return(new TextDecoder).decode(s)}enterScope(t){const e=[],r={alloc:t=>{const r=this.alloc(t);return e.unshift(r),r},allocString:t=>{const r=this.allocString(t);return e.unshift(r),r}};try{return t(r)}finally{for(const t of e)this.free(t)}}}class p{size;date;attrib;name;constructor(t,e,r,n){this.size=t,this.date=e,this.attrib=r,this.name=n}static fromFilInfo(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength),r=e.getUint32(0,!0),n=e.getUint16(4,!0),s=1980+((65024&n)>>9),i=((480&n)>>5)-1,o=31&n,c=e.getUint16(6,!0),a=new Date(s,i,o,(63488&c)>>11,(2016&c)>>5,2*(31&c)),l=t[8],h=t.subarray(9,22),f=h.indexOf(0),u=f>=0?h.subarray(0,f):h,d=(new TextDecoder).decode(u);return new p(r,a,l,d)}get isReadOnly(){return!!(this.attrib&t.FatFsAttrib.RDO)}get isDirectory(){return!!(this.attrib&t.FatFsAttrib.DIR)}get isHidden(){return!!(this.attrib&t.FatFsAttrib.HID)}get isArchive(){return!!(this.attrib&t.FatFsAttrib.ARC)}get isSystem(){return!!(this.attrib&t.FatFsAttrib.SYS)}}class x extends Error{result;constructor(e,r){super(`Error ${e}: ${t.FatFsResult[r]} (${r})`),Object.setPrototypeOf(this,x.prototype),this.result=r}}class g{#s;#n;#e;constructor(t,e,r){this.#s=t,this.#n=e,this.#e=r}get fp(){return this.#s}read(t,e){const r=this.#n.f_read,n=this.#s,s=e??t.length;return this.#e.enterScope((e=>{const i=e.alloc(s),o=e.alloc(4);h("reading file",(()=>r(n,i,s,o)));const c=this.#e.view.getUint32(o,!0);return t.set(this.#e.heap.subarray(i,i+c)),c}))}write(t,e){return this.#e.enterScope((r=>{const n=e??t.length,s=r.alloc(n),i=r.alloc(4);return this.#e.heap.subarray(s,s+n).set(t),h("writing file",(()=>this.#n.f_write(this.#s,s,n,i))),this.#e.view.getUint32(i,!0)}))}close(){try{h("closing file",(()=>this.#n.f_close(this.#s)))}finally{this.#n.free(this.#s)}}sync(){h("syncing disk",(()=>this.#n.f_sync(this.#s)))}lseek(t){h("seeking",(()=>this.#n.f_lseek(this.#s,t)))}rewind(){this.lseek(0)}truncate(){h("truncating file",(()=>this.#n.f_truncate(this.#s)))}expand(t,e){h("expanding file",(()=>this.#n.f_expand(this.#s,t,e)))}gets(t){return this.#e.enterScope((e=>{const r=e.alloc(t+1);return h("reading string from file",(()=>this.#n.f_gets(r,t,this.#s))),this.#e.decodeString(r,t+1)}))}putc(t){const e=t%256;return this.#n.f_putc(e,this.#s)}puts(t){const e=this.#n.f_puts;return this.#e.enterScope((r=>{const n=r.allocString(t);return e(n,this.#s)}))}tell(){return this.#n.f_tell(this.#s)}eof(t){return this.#n.f_eof(this.#s)}size(){return this.#n.f_size(this.#s)}error(t){return this.#n.f_error(this.#s)}}class _{#i;#n;#e;constructor(t,e,r){this.#i=t,this.#n=e,this.#e=r}get dp(){return this.#i}close(){h("closing directory",(()=>this.#n.f_closedir(this.#i))),this.#e.free(this.#i)}read(){return this.#e.enterScope((t=>{const e=t.alloc(c);h("reading directory",(()=>this.#n.f_readdir(this.#i,e)));const r=this.#e.heap.subarray(e,e+c);return p.fromFilInfo(r)}))}rewind(){h("rewinding directory",(()=>this.#n.f_readdir(this.#i,0)))}findNext(){return this.#e.enterScope((t=>{const e=t.alloc(c);h("searching directory for next match",(()=>this.#n.f_findnext(this.#i,e)));const r=this.#e.heap.subarray(e,e+c);return p.fromFilInfo(r)}))}*[Symbol.iterator](){let t;for(this.rewind();""!==(t=this.read()).name;)yield t}}const F={multiPartition:!1,sectorSize:512};class S{#e;#n;static async create(t,e){const r=new WebAssembly.Memory({initial:8}),n={...F,...e??{}},s=f(r,t,n.sectorSize),i=await async function(t,e){const r=e?.multiPartition?a:l;if("undefined"!=typeof window)return await WebAssembly.instantiateStreaming(fetch(r),t);{const{readFile:e}=await import("node:fs/promises"),{fileURLToPath:n}=await import("node:url"),s=await e(n(r));return await WebAssembly.instantiate(s,t)}}(s,n),o=i.instance.exports,c=new d(r,o);return n.multiPartition?new m(c,o):new S(c,o)}constructor(t,e){this.#e=t,this.#n=e}mkfs(t){this.#e.enterScope((e=>{const r=e.allocString(t?.path??"");let n=0;if(null!=t){n=e.alloc(16);const r=this.#e.view;r.setUint8(n,t?.fmt??0),r.setUint8(n+1,t?.nFat??0),r.setUint32(n+2,t?.align??0,!0),r.setUint32(n+6,t?.nRoot??0,!0),r.setUint32(n+10,t?.auSize??0,!0)}const s=e.alloc(4096);h("formatting disk",(()=>this.#n.f_mkfs(r,n,s,4096)))}))}mount(t,e){const r=t=>this.#e.alloc(t);return this.#e.enterScope((n=>{const s=r(560);for(let t=0;t<560;t++)this.#e.heap[s+t]=0;const i=n.allocString(t??"");return h("mounting workspace",(()=>this.#n.f_mount(s,i,e??0)),(()=>this.#e.free(s))),new u(s,this.#e)}))}unmount(t){return this.#e.enterScope((e=>{try{const r=e.allocString(t??"");h("unmounting workspace",(()=>this.#n.f_mount(0,r,0)))}finally{}}))}open(t,e){return this.#e.enterScope((r=>{const n=r.allocString(t),s=this.#e.alloc(576);return h("opening file",(()=>this.#n.f_open(s,n,e)),(()=>this.#e.free(s))),new g(s,this.#n,this.#e)}))}session(t,e=""){this.mount(e);try{return t()}finally{this.unmount(e)}}readFile(e){const r=this.stat(e),n=new Uint8Array(r.size),s=this.open(e,t.FatFsMode.READ);try{return s.read(n),n}finally{s.close()}}writeFile(e,r){const n=this.open(e,t.FatFsMode.WRITE|t.FatFsMode.OPEN_ALWAYS);try{n.write(r)}finally{n.close()}}openDir(t){return this.#e.enterScope((e=>{const r=e.allocString(t),n=this.#e.alloc(64);return h("opening directory",(()=>this.#n.f_opendir(n,r)),(()=>this.#e.free(n))),new _(n,this.#n,this.#e)}))}findFirst(t,e){return this.#e.enterScope((r=>{const n=r.allocString(t),s=r.allocString(e),i=r.alloc(c),o=this.#e.alloc(64);h("searching directory",(()=>this.#n.f_findfirst(o,i,n,s)));const a=this.#e.heap.subarray(i,i+c);return[new _(o,this.#n,this.#e),p.fromFilInfo(a)]}))}*find(t,e){let r,n;for([r,n]=this.findFirst(t,e);""!==n.name;)yield n,n=r.findNext()}stat(t){return this.#e.enterScope((e=>{const r=e.allocString(t),n=e.alloc(c);h("getting file information",(()=>this.#n.f_stat(r,n)));const s=this.#e.heap.subarray(n,n+c);return p.fromFilInfo(s)}))}unlink(t){this.#e.enterScope((e=>{const r=e.allocString(t);h("deleting file or directory",(()=>this.#n.f_unlink(r)))}))}rename(t,e){this.#e.enterScope((r=>{const n=r.allocString(t),s=r.allocString(e);h("renaming file or directory",(()=>this.#n.f_rename(n,s)))}))}chmod(t,e,r){this.#e.enterScope((n=>{const s=n.allocString(t);h("changing file or directory permissions",(()=>this.#n.f_chmod(s,e,r)))}))}utime(t,e){this.#e.enterScope((r=>{const n=r.allocString(t),s=r.alloc(24),i=(e.getFullYear()-1980&127)<<9|e.getMonth()+1<<5|e.getDay();this.#e.view.setUint16(s+4,i,!0);const o=e.getHours()<<11|e.getMinutes()<<5|e.getSeconds()>>>1;this.#e.view.setUint16(s+6,o,!0),h("changing timestamp of file or directory",(()=>this.#n.f_utime(n,s)))}))}mkdir(t){this.#n.f_mkdir,this.#e.enterScope((e=>{const r=e.allocString(t);h("creating directory",(()=>this.#n.f_mkdir(r)))}))}chdir(t){this.#e.enterScope((e=>{const r=e.allocString(t);h("changing current directory",(()=>this.#n.f_chdir(r)))}))}chdrive(t){this.#e.enterScope((e=>{const r=e.allocString(t);h("changing current drive",(()=>this.#n.f_chdrive(r)))}))}getcwd(){return this.#e.enterScope((t=>{const e=t.alloc(260);return h("getting current directory",(()=>this.#n.f_getcwd(e,260))),this.#e.decodeString(e,260)}))}getFree(t){return this.#e.enterScope((e=>{const r=e.allocString(t??""),n=e.alloc(4),s=e.alloc(4);return h("getting free space on drive",(()=>this.#n.f_getfree(r,n,s))),[this.#e.view.getUint32(n,!0),new u(s,this.#e)]}))}getLabel(t){return this.#e.enterScope((e=>{const r=e.allocString(t??""),n=e.alloc(13);this.#e.heap[n+12]=0;const s=e.alloc(4);return h("getting volume label",(()=>this.#n.f_getlabel(r,n,s))),[this.#e.decodeString(n,13),this.#e.view.getUint32(s,!0)]}))}setLabel(t){this.#e.enterScope((e=>{const r=e.allocString(t);h("setting volume label",(()=>this.#n.f_setlabel(r)))}))}setCP(t){const e=this.#n.f_setcp;h("setting active code page",(()=>e(t)))}}class m extends S{#e;#n;constructor(t,e){super(t,e),this.#e=t,this.#n=e}fdisk(t,e){this.#e.enterScope((r=>{const n=r.alloc(512),s=r.alloc(4*t.length);for(let e=0;e<t.length;e++)this.#e.view.setUint32(s+4*e,t[e]);h("partitioning disk",(()=>this.#n.f_fdisk(e??0,s,n)))}))}}t.FatFsDir=_,t.FatFsDisk=S,t.FatFsDiskPartitionable=m,t.FatFsError=x,t.FatFsFile=g,t.FatFsFileInfo=p}));
//# sourceMappingURL=fatfs.min.js.map
